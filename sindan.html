<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StellaMC サーバー分析</title>
    <style>
        /* ====== Google Fonts & 基本設定 ====== */
        @import url('https://fonts.googleapis.com/css2?family=Kosugi+Maru&family=Rajdhani:wght@600&display=swap');

        :root {
            --font-display: 'Rajdhani', sans-serif;
            --font-main: 'Kosugi Maru', sans-serif;
            --bg-color: #0d0c1d;
            --surface-color: rgba(22, 23, 44, 0.6);
            --primary-color: #a67cff;
            --text-color: #e0e0e0;
            --text-muted: #a0a0b0;
            --border-glow: rgba(166, 124, 255, 0.3);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --tenkuu-color: #8be9fd;
            --bouken-color: #f1fa8c;
            --seikatsu-color: #ffb86c;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-main);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-color);
            overflow: hidden;
            padding: 1rem;
        }
        
        #background-stars {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-image:
                radial-gradient(1px 1px at 25% 15%, #fff, transparent),
                radial-gradient(1px 1px at 50% 35%, #fff, transparent),
                radial-gradient(1.5px 1.5px at 75% 55%, #fff, transparent),
                radial-gradient(1px 1px at 60% 85%, #fff, transparent),
                radial-gradient(1.5px 1.5px at 15% 90%, #fff, transparent);
            animation: twinkle 20s linear infinite;
        }
        
        .container {
            width: 100%; max-width: 720px;
            background-color: var(--surface-color);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            box-shadow: 0 0 40px var(--shadow-color);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden; z-index: 1;
        }

        .screen { padding: 50px; text-align: center; }
        .quiz-screen-padding { padding: 40px; }

        #start-screen h1 {
            font-family: var(--font-display);
            font-size: 3rem; letter-spacing: 2px;
            color: #fff; margin-bottom: 1rem;
            text-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color);
            line-height: 1.4;
        }
        #start-screen p { font-size: 1.1rem; line-height: 1.8; margin-bottom: 2.5rem; color: var(--text-muted); }
        .main-btn {
            font-family: var(--font-display);
            font-size: 1.5rem; padding: 16px 45px;
            letter-spacing: 1px; background: transparent;
            color: #fff; border: 2px solid var(--primary-color);
            border-radius: 12px; cursor: pointer;
            box-shadow: 0 0 15px var(--border-glow);
            transition: all 0.2s ease-out;
            text-shadow: 0 0 5px var(--primary-color);
        }
        .main-btn:hover { background-color: var(--primary-color); color: var(--bg-color); box-shadow: 0 0 25px var(--primary-color); }
        
        #step-counter {
            font-family: var(--font-display);
            color: var(--text-muted);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        #question-text { font-size: 1.8rem; font-weight: 600; margin-bottom: 2rem; line-height: 1.6; color: #fff; text-align: center; }
        .options-container { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .option-btn {
            padding: 25px 20px; font-size: 1.2rem;
            background-color: rgba(0,0,0,0.2);
            border: 2px solid var(--border-glow);
            color: var(--text-color); font-weight: 600;
            border-radius: 12px; cursor: pointer;
            text-align: center; transition: all 0.2s ease;
            display: flex; align-items: center; justify-content: center;
            min-height: 100px;
        }
        .option-btn:hover { background-color: var(--surface-color); border-color: var(--primary-color); transform: scale(1.05); }
        .quiz-footer { margin-top: 2rem; }
        .back-btn {
            font-family: var(--font-display);
            background: none; border: none; color: var(--text-muted);
            cursor: pointer; font-size: 1.1rem; padding: 5px 10px;
            transition: color 0.2s;
        }
        .back-btn:hover { color: var(--text-color); }
        
        #result-screen > *, #analysis-complete-screen > * { opacity: 0; }
        #result-screen h2, #analysis-complete-screen h2 { font-family: var(--font-display); font-size: 1.8rem; letter-spacing: 1px; margin-bottom: 1.5rem; color: var(--text-muted); }
        #analysis-complete-screen p { font-size: 1.2rem; line-height: 1.8; margin-bottom: 2.5rem; color: var(--text-color); }

        .result-chart-container { margin-bottom: 2.5rem; }
        .chart-bar { display: flex; align-items: center; margin-bottom: 1rem; }
        .chart-label { font-family: var(--font-display); width: 110px; padding-left: 10px; text-align: left; font-size: 1.2rem; }
        .chart-progress { flex: 1; height: 24px; background: rgba(0,0,0,0.3); border-radius: 6px; overflow: hidden; }
        .chart-value-bar {
            width: 0; height: 100%;
            transition: width 1s cubic-bezier(0.25, 1, 0.5, 1);
            line-height: 24px; color: var(--bg-color); font-weight: bold;
            text-align: right; padding-right: 12px; font-size: 1rem;
        }
        .highlight .chart-value-bar { animation: glow 1.5s infinite alternate; }
        #tenkuu-bar .chart-value-bar { background-color: var(--tenkuu-color); }
        #bouken-bar .chart-value-bar { background-color: var(--bouken-color); }
        #seikatsu-bar .chart-value-bar { background-color: var(--seikatsu-color); }
        .analysis-details { opacity: 0; transform: translateY(20px); transition: opacity 0.5s, transform 0.5s; }
        #archetype-title { font-size: 2.2rem; font-weight: 800; color: #fff; margin-bottom: 1rem; text-shadow: 0 0 10px var(--primary-color); }
        #archetype-description { font-size: 1.1rem; line-height: 1.9; text-align: left; white-space: pre-wrap; }
        .restart-btn {
            font-family: var(--font-display); font-size: 1.2rem; padding: 12px 30px;
            background: transparent; color: var(--text-muted);
            border: 2px solid var(--text-muted); cursor: pointer;
            border-radius: 8px; transition: all 0.2s ease; margin-top: 2rem;
        }
        .restart-btn:hover { background-color: var(--primary-color); border-color: var(--primary-color); color: var(--bg-color); font-weight: bold; }
        
        .anim-fade-in { animation: fadeIn 0.8s ease-out forwards; }
        .anim-fade-out { animation: fadeOut 0.4s ease-in forwards; }
        .anim-pop-in { animation: popIn 0.6s cubic-bezier(0.25, 1, 0.5, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        @keyframes glow { from { box-shadow: 0 0 8px 0px currentColor; } to { box-shadow: 0 0 20px 3px currentColor; } }
        @keyframes twinkle { from { transform: translateY(0); } to { transform: translateY(-100vh); } }
        
        @media (max-width: 680px) {
            .screen, .quiz-screen-padding { padding: 25px; }
            #start-screen h1 { font-size: 2.2rem; }
            #question-text { font-size: 1.4rem; }
            .options-container { grid-template-columns: 1fr; }
            #archetype-title { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div id="background-stars"></div>
    <div class="container" id="container">
        <div id="start-screen" class="screen anim-fade-in">
            <h1>StellaMC サーバー分析</h1>
            <p>自分に一番マッチするサーバーを分析しよう！</p>
            <button class="main-btn" id="start-btn">分析を開始する</button>
        </div>
        <div id="quiz-screen" class="screen quiz-screen-padding" style="display: none;">
            <p id="step-counter"></p>
            <div id="question-wrapper"></div>
            <div class="quiz-footer">
                <button id="back-btn" class="back-btn" style="display: none;">&lt; ひとつ前に戻る</button>
            </div>
        </div>
        <div id="analysis-complete-screen" class="screen" style="display: none;">
            <h2 class="anim-fade-in">ANALYSIS COMPLETE</h2>
            <p class="anim-fade-in" style="animation-delay: 0.2s;">サーバー分析が終了しました！</p>
            <button class="main-btn anim-fade-in" id="view-results-btn" style="animation-delay: 0.4s;">結果を見る</button>
        </div>
        <div id="result-screen" class="screen" style="display: none;">
            <h2 class="result-anim">YOUR ARCHETYPE IS...</h2>
            <div class="result-chart-container result-anim">
                <div class="chart-bar" id="tenkuu-bar"><div class="chart-label">天空鯖</div><div class="chart-progress"><div class="chart-value-bar"></div></div></div>
                <div class="chart-bar" id="bouken-bar"><div class="chart-label">冒険鯖</div><div class="chart-progress"><div class="chart-value-bar"></div></div></div>
                <div class="chart-bar" id="seikatsu-bar"><div class="chart-label">生活鯖</div><div class="chart-progress"><div class="chart-value-bar"></div></div></div>
            </div>
            <div class="analysis-details">
                <h3 id="archetype-title"></h3>
                <p id="archetype-description"></p>
                <button class="restart-btn" id="restart-btn">もう一度分析する</button>
            </div>
        </div>
    </div>
    
    <audio id="click-sound" preload="auto" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU0HT19OALe/ub+3v7W/tb20vrS+s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO9s72zvbO-"></audio>
    <audio id="result-sound" preload="auto" src="data:audio/wav;base64,UklGRoh+AABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQBofAAAAP//AgAJAAYADwAbABoAFgAJAP//AwAIAAcACwAUABUADgAEAPkABQADAAUACwASABQADQADAPkABgAEAAUACwAUABQADgADAPgABwAFAAYADQATABQADwAEAPkABQACAAcADQAUABMADgACAPkACAAEAAQACwATABQADgADAPgABgADAAQADQATABQADgADAPgABgAEAAUADQATABMADgAEAPcABwAFAAYADgATABMADgADAPgABgADAAQADQASABMADwAEAPcABwAFAAYADQASABMADgADAPgABQADAAQADQASABMADwAEAPcABwAFAAYADQASABMADgADAPgABQADAAQADQASABMADwAEAPcABQAEAAcADQASABMADgACAPkACAAFAAYADQASABMADgADAPgABQADAAQACwASABMADwAEAPcABwAFAAYADQASABQADgADAPgABQACAAQADQASABQADwAEAPcABwAFAAYADQASABMADgADAPgABQADAAQADQASABMADwAEAPcABQAEAAcADQASABQADgADAPgACAAFAAYADQASABMADgADAPgABQADAAQACwASABMADwAEAPcABwAFAAYADQASABQADgADAPgABQACAAQADQASABQADwAEAPcABwAFAAYADQASABMADgADAPgABQADAAQADQASABMADwAEAPcABQAEAAcADQASABQADgADAPgACAAFAAYADQASABMADgAEAPcABgAFAAUADQATABQADgADAPgABQACAAUACwATABMADgAEAPgABwAFAAYADQATABQADwAEAPcABwAFAAYADQATABQADwAEAPgABwAFAAYADgATABMADgAEAPgABgAEAAUADgATABMADgAEAPgABwAFAAYADgATABQADwADAPgABgAEAAUADQATABMADgAEAPcABwAFAAYADQATABMADgADAPgABgADAAQADQATABMADwAEAPcABwAFAAYADQATABMADgAEAPgABgAEAAUADgATABMADgADAPgABwAFAAYADQATABQADwAEAPcABwAFAAYADQATABMADgADAPgABgADAAQADQATABMADwAEAPcABwAFAAYADQATABMADgAEAPgABgAEAAUADQATABMADgAEAPgABwAFAAYADQATABQADwADAPgABgAEAAUACwATABMADgAEAPcABwAFAAYADQATABQADgADAPgABgADAAQADQATABQADwAEAPcABgAFAAYADQATABQADgAEAPgABgAEAAUADgATABMADgAEAPgABwAFAAYADQATABQADwADAPgABgAEAAUACwATABMADgAABABAAQsDFgMnAysDRQRaBgMAAAAA//8B/gD8AP8BAwIFAQ4CHQEnAS8BOAFDAU0BUgFhAWsBcwF/AYYBigGOAY8BkwGVAZgBmwGfAaIBpQGqAa4BswG6Ab4BwwHHAdEB0wHWAd0B4AHkAesB8AHyAfYB+AH+AgECCQIOAhYCHQEkASkBMQE7AUIBSQFMAVIAVwFbAWQBawF0AXkBfwGJAZsBox/DGb0ZpBmuGacZqBmqGaoZpxmnGaYapiqfKp4rni2LqAxoDKfMaYyoTKiMqEyojKgMaAxoC+gL6AvoC6fLZsslyycK5MrkytgLQAtfS1eLGUsaixqK2YrKitlKSUo5CcdJxwmmyKaIdMa0ArYAtUC0QLLAsMevx6sHqgeoB6XHSMdHB0eGxsZGBkXGRYaEhMQDw8JDwcFAwICAv7+/v38/Pn49/f39vf29fX08/Py8u/u7evq6ejn5eLh4N/d3dva2dbV09HT0c/NzMvKyMjExsPCwcG/vr28ury5t7i3tLW0s7GwsK+ur6uqqamnp6WkpaOjoaSioaGg/+De3drY1NPS0M7My8fGwsK+vby5t7W0srCvrqmpqaalpKSioaGfn56dnZyanJuaWlhXV1RTUVFQT05NTEpKSkdGRUM/PDs5ODc1NDMyLy0rKScmJSQjIiAfHx4dHBsaGRgWFRQRDg0LCQgHBgQCAf/+/v39/f39/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v-"></audio>

    <script>
        const DOM = {
            startScreen: document.getElementById('start-screen'),
            quizScreen: document.getElementById('quiz-screen'),
            analysisCompleteScreen: document.getElementById('analysis-complete-screen'),
            resultScreen: document.getElementById('result-screen'),
            startBtn: document.getElementById('start-btn'),
            restartBtn: document.getElementById('restart-btn'),
            backBtn: document.getElementById('back-btn'),
            viewResultsBtn: document.getElementById('view-results-btn'),
            questionWrapper: document.getElementById('question-wrapper'),
            stepCounter: document.getElementById('step-counter'),
            analysisDetails: document.querySelector('.analysis-details'),
        };
        const clickSound = document.getElementById('click-sound');
        const resultSound = document.getElementById('result-sound');

        const quizTree = {
            'start': { question: "あなたの根源的な欲求は、どちらに近いですか？", options: [ { text: "他者に打ち勝ち、頂点に立つ", next: 'c1' }, { text: "誰かと力を合わせ、偉業を成す", next: 'p1' } ] },
            'c1': { question: "頂点に立つための、あなたの理想的な手段は？", options: [ { text: "純粋な実力と効率で、他者を圧倒する", next: 'c2_eff' }, { text: "好敵手と競い合い、共に成長する", next: 'c2_rival' } ] },
            'c2_eff': { question: "あなたが求める「効率」の本質とは？", options: [ { text: "時間を支配し、作業を極限まで自動化する", next: 'c3_auto' }, { text: "最強の武具を手にし、戦闘を瞬時に終わらせる", next: 'c3_combat' } ] },
            'c3_auto': { question: "その『究極の効率』を、何のために使いますか？", options: [ { text: "更なる効率化という、終わらない探求のため", next: 'c4_pursuit' }, { text: "誰にも邪魔されない、自分だけの領域を確立するため", next: 'c4_domain' } ] },
            'c4_pursuit': { question: "あなたの自動化装置が、サーバーの経済を破壊する可能性が。どうしますか？", options: [ { text: "それもまた一興。システムの限界を見る", next: 'r_optimizer' }, { text: "影響を考慮し、出力を調整・管理する", next: 'r_architect' } ] },
            'c4_domain': { question: "他者があなたの領域に助けを求めてきました。どうしますか？", options: [ { text: "対価を要求し、ビジネスとして交渉する", next: 'r_solitary_king' }, { text: "無視する。自分の平和が最優先だ", next: 'r_hermit' } ] },
            'c3_combat': { question: "絶対的な『武力』を手にしたあなた。その力で何をしますか？", options: [ { text: "全ての戦いに勝利し、最強の称号を手に入れる", next: 'c4_glory' }, { text: "危険な秘境に挑み、古代の秘宝を独占する", next: 'c4_treasure' } ] },
            'c4_glory': { question: "最強となったあなた。その強さをどう維持しますか？", options: [ { text: "常に挑戦者を求め、戦いの中で強さを証明し続ける", next: 'r_gladiator' }, { text: "更なる効率を求め、装備を完璧に磨き上げる", next: 'r_battle_master' } ] },
            'c4_treasure': { question: "秘宝の最後の守護者が、あなたに問いかけます。「力とは何か？」と。どう答える？", options: [ { text: "「目的を達成するための、最も純粋な手段だ」", next: 'r_treasure_hunter' }, { text: "「守るべきものを、守り抜くための覚悟だ」", next: 'r_guardian' } ] },
            'c2_rival': { question: "その競争の先に、あなたが本当に求めるものは？", options: [ { text: "最終的な勝利と、サーバーに名を刻む「名声」", next: 'c3_fame' }, { text: "まだ誰も知らない「未知」への一番乗り", next: 'c3_pioneer' } ] },
            'c3_fame': { question: "頂点に立ったあなた。次に何を望みますか？", options: [ { text: "新たな挑戦者を求め、戦いの日々を続ける", next: 'r_duelist' }, { text: "自分の伝説を語り継ぎ、後進を育てる", next: 'r_legend' } ] },
            'c3_pioneer': { question: "一番乗りした『未知の領域』。その後どうしますか？", options: [ { text: "すぐさま拠点を築き、その地を完全に支配する", next: 'r_pioneer' }, { text: "発見を記録し、また次の未知を探しに旅立つ", next: 'r_wanderer' } ] },
            'p1': { question: "あなたの理想とする「協力」の形は？", options: [ { text: "役割を分担し、巨大な敵や難関に挑む", next: 'p2_party' }, { text: "同じ世界で暮らし、巨大な街や国を創る", next: 'p2_city' } ] },
            'p2_party': { question: "仲間との冒険で、最も心が震える瞬間は？", options: [ { text: "絶体絶命の状況を、完璧な連携で覆すこと", next: 'p3_tactics' }, { text: "未知の発見や絶景を、仲間と分かち合うこと", next: 'p3_discovery' } ] },
            'p3_tactics': { question: "あなたがチームを率いる時、最も重視することは？", options: [ { text: "緻密な作戦と、各員の役割の徹底", next: 'p4_plan' }, { text: "何よりも仲間を信じ、その場の閃きを大切にする", next: 'p4_trust' } ] },
            'p4_plan': { question: "作戦に反対する仲間がいます。どうしますか？", options: [ { text: "データを元に、合理的に説得する", next: 'r_commander' }, { text: "目的は同じはず。対話し、計画を修正する", next: 'r_leader' } ] },
            'p4_trust': { question: "あなたの作戦が裏目に出て、仲間が危険に。どうしますか？", options: [ { text: "自らを犠牲にしても、仲間を必ず救う", next: 'r_vanguard' }, { text: "冷静に状況を分析し、最善の撤退を指示する", next: 'r_commander' } ] },
            'p3_discovery': { question: "旅の目的が達成された後、あなたはどうしますか？", options: [ { text: "これまでの冒険の記録をまとめ、地図を完成させる", next: 'r_explorer' }, { text: "仲間と共に祝杯をあげ、思い出を語り明かす", next: 'p4_memory' } ] },
            'p4_memory': { question: "その思い出を、どのような形で残したいですか？", options: [ { text: "冒険の証として、記念の建築物を建てる", next: 'r_monument_builder' }, { text: "次の冒険者への道標として、物語を語り継ぐ", next: 'r_bard' } ] },
            'p2_city': { question: "あなたが創る街で、最も得意な役割は？", options: [ { text: "人々の生活を支える、機能的なインフラを整備する", next: 'p3_infra' }, { text: "誰もが心癒される、美しい景観や芸術を創造する", next: 'p3_art' } ] },
            'p3_infra': { question: "街が発展し、新たな問題が発生しました。どう対応しますか？", options: [ { text: "問題の根源を分析し、システムで解決する", next: 'r_architect' }, { text: "住民集会を開き、皆の意見を聞いて決める", next: 'r_mayor' } ] },
            'p3_art': { question: "あなたの芸術が、誰にも理解されなかったら？", options: [ { text: "それでも自分の信じる「美」を追求し続ける", next: 'r_artist' }, { text: "人々の声に耳を傾け、皆に愛される作品を創る", next: 'r_designer' } ] },
            
            'r_optimizer': { result: true, title: "純粋なる最適化主義者", scores: { tenkuu: 95, bouken: 5, seikatsu: 0 } },
            'r_solitary_king': { result: true, title: "孤独なる自動化の王", scores: { tenkuu: 85, bouken: 0, seikatsu: 15 } },
            'r_hermit': { result: true, title: "世界から隔絶した賢者", scores: { tenkuu: 70, bouken: 5, seikatsu: 25 } },
            'r_gladiator': { result: true, title: "常勝のグラディエーター", scores: { tenkuu: 80, bouken: 20, seikatsu: 0 } },
            'r_battle_master': { result: true, title: "戦闘の効率を極めし者", scores: { tenkuu: 85, bouken: 15, seikatsu: 0 } },
            'r_treasure_hunter': { result: true, title: "秘宝を独占する探検家", scores: { tenkuu: 60, bouken: 40, seikatsu: 0 } },
            'r_guardian': { result: true, title: "古代遺跡の守護者", scores: { tenkuu: 40, bouken: 50, seikatsu: 10 } },
            'r_duelist': { result: true, title: "名声を求める決闘者", scores: { tenkuu: 70, bouken: 30, seikatsu: 0 } },
            'r_legend': { result: true, title: "生ける伝説", scores: { tenkuu: 50, bouken: 30, seikatsu: 20 } },
            'r_pioneer': { result: true, title: "未踏世界の開拓者", scores: { tenkuu: 40, bouken: 60, seikatsu: 0 } },
            'r_wanderer': { result: true, title: "永遠の放浪者", scores: { tenkuu: 10, bouken: 80, seikatsu: 10 } },
            'r_leader': { result: true, title: "伝説のパーティリーダー", scores: { tenkuu: 15, bouken: 85, seikatsu: 0 } },
            'r_vanguard': { result: true, title: "仲間を導く先導者", scores: { tenkuu: 5, bouken: 80, seikatsu: 15 } },
            'r_commander': { result: true, title: "冷静なる司令官", scores: { tenkuu: 20, bouken: 70, seikatsu: 10 } },
            'r_explorer': { result: true, title: "世界を識る探検家", scores: { tenkuu: 0, bouken: 75, seikatsu: 25 } },
            'r_monument_builder': { result: true, title: "冒険の記念碑を建てる者", scores: { tenkuu: 5, bouken: 45, seikatsu: 50 } },
            'r_bard': { result: true, title: "冒険を謳う旅の吟遊詩人", scores: { tenkuu: 0, bouken: 60, seikatsu: 40 } },
            'r_architect': { result: true, title: "大都市のインフラ設計者", scores: { tenkuu: 40, bouken: 10, seikatsu: 50 } },
            'r_mayor': { result: true, title: "民に愛される街の長", scores: { tenkuu: 10, bouken: 20, seikatsu: 70 } },
            'r_artist': { result: true, title: "世界を彩る芸術家", scores: { tenkuu: 0, bouken: 15, seikatsu: 85 } },
            'r_designer': { result: true, title: "みんなに愛される設計士", scores: { tenkuu: 5, bouken: 25, seikatsu: 70 } },
        };

        let currentNodeId = 'start';
        let step = 0;
        let pathHistory = [];
        let finalResultNode = null;
        
        const playSound = (sound) => { sound.currentTime = 0; sound.play().catch(e => {}); };

        function startQuiz() {
            playSound(clickSound);
            currentNodeId = 'start';
            step = 0;
            pathHistory = [];
            DOM.startScreen.classList.remove('anim-fade-in');
            DOM.startScreen.classList.add('anim-fade-out');
            setTimeout(() => {
                DOM.startScreen.style.display = 'none';
                DOM.quizScreen.style.display = 'block';
                showQuestion(currentNodeId);
            }, 400);
        }
        
        function showQuestion(nodeId) {
            const node = quizTree[nodeId];
            step++;
            DOM.stepCounter.textContent = `STEP ${step}`;
            DOM.backBtn.style.display = pathHistory.length > 0 ? 'inline-block' : 'none';
            
            const questionContainer = document.createElement('div');
            questionContainer.className = 'question-container';
            questionContainer.innerHTML = `
                <h2 id="question-text">${node.question}</h2>
                <div class="options-container">
                    ${node.options.map(option => `<button class="option-btn" data-next="${option.next}">${option.text}</button>`).join('')}
                </div>`;
            
            DOM.questionWrapper.innerHTML = '';
            DOM.questionWrapper.appendChild(questionContainer);
            questionContainer.classList.add('anim-pop-in');
            document.querySelectorAll('.option-btn').forEach(button => button.addEventListener('click', handleOptionClick));
        }
        
        function handleOptionClick(event) {
            playSound(clickSound);
            const nextNodeId = event.target.dataset.next;
            pathHistory.push(currentNodeId);
            currentNodeId = nextNodeId;
            DOM.questionWrapper.firstElementChild.classList.add('anim-fade-out');
            setTimeout(() => {
                const nextNode = quizTree[nextNodeId];
                if (nextNode.result) {
                    showAnalysisComplete(nextNode);
                } else {
                    showQuestion(nextNodeId);
                }
            }, 400);
        }

        function goBack() {
            if (pathHistory.length === 0) return;
            playSound(clickSound);
            step -= 2; // back step is -1, next showQuestion is +1
            currentNodeId = pathHistory.pop();
            DOM.questionWrapper.firstElementChild.classList.add('anim-fade-out');
            setTimeout(() => showQuestion(currentNodeId), 400);
        }

        function showAnalysisComplete(resultNode) {
            finalResultNode = resultNode;
            DOM.quizScreen.classList.add('anim-fade-out');
            setTimeout(() => {
                DOM.quizScreen.style.display = 'none';
                DOM.analysisCompleteScreen.style.display = 'block';
                DOM.analysisCompleteScreen.querySelectorAll('.anim-fade-in').forEach(el => el.style.opacity = '1');
            }, 400);
        }

        function displayFinalResult() {
            playSound(resultSound);
            DOM.analysisCompleteScreen.classList.add('anim-fade-out');
            setTimeout(() => {
                DOM.analysisCompleteScreen.style.display = 'none';
                DOM.analysisCompleteScreen.classList.remove('anim-fade-out');
                DOM.analysisCompleteScreen.querySelectorAll('.anim-fade-in').forEach(el => el.style.opacity = '0');

                DOM.resultScreen.style.display = 'block';
                DOM.resultScreen.querySelectorAll('.result-anim').forEach(el => el.classList.add('anim-fade-in'));
                
                const scores = finalResultNode.scores;
                const primaryKey = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);

                const animateBar = (key, delay) => {
                    setTimeout(() => {
                        const bar = document.querySelector(`#${key}-bar .chart-value-bar`);
                        const percentage = scores[key] || 0;
                        bar.style.width = `${percentage}%`;
                        bar.textContent = `${percentage}%`;
                        if (key === primaryKey) document.getElementById(`${key}-bar`).classList.add('highlight');
                    }, delay);
                };
                
                animateBar('tenkuu', 500);
                animateBar('bouken', 700);
                animateBar('seikatsu', 900);
                
                setTimeout(() => {
                    const finalDesc = getResultDescription(finalResultNode.title, scores);
                    DOM.analysisDetails.querySelector('#archetype-title').textContent = `あなたの原型は...`;
                    DOM.analysisDetails.querySelector('#archetype-description').textContent = finalDesc;
                    DOM.analysisDetails.style.opacity = 1;
                    DOM.analysisDetails.style.transform = 'translateY(0)';
                }, 1500);
            }, 400);
        }
        
        function getResultDescription(title, scores) {
             const p = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
             const s = Object.keys(scores).filter(k => k !== p).reduce((a, b) => scores[a] > scores[b] ? a : b);
             const serverMap = { tenkuu: "天空鯖", bouken: "冒険鯖", seikatsu: "生活鯖" };
             const verbMap = { tenkuu: "効率化", bouken: "冒険", seikatsu: "創造" };
             let core = `あなたは、自らの本質が「${verbMap[p]}」にあると知る人間です。`;
             let synergy = `その上で「${verbMap[s]}」への強い衝動も併せ持ち、二つの才能を融合させて独自の道を歩みます。`;
             if(scores[s] < 10) synergy = `あなたの情熱は一つのことに深く注がれ、その分野で他の追随を許さない圧倒的な成果を生み出すでしょう。`
             let recommendation = `あなたの魂が最も輝く場所は【${serverMap[p]}】です。そして、もし新たな刺激が欲しくなったなら【${serverMap[s]}】の門を叩くと、まだ見ぬ自分に出会えるでしょう。`;
             return `【${title}】\n\n${core}\n${synergy}\n\n${recommendation}`;
        }

        function restartQuiz() {
            playSound(clickSound);
            DOM.resultScreen.classList.add('anim-fade-out');
            setTimeout(() => {
                DOM.resultScreen.style.display = 'none';
                DOM.resultScreen.classList.remove('anim-fade-out');
                DOM.quizScreen.classList.remove('anim-fade-out');
                
                DOM.startScreen.style.display = 'block';
                DOM.startScreen.classList.remove('anim-fade-out');
                DOM.startScreen.classList.add('anim-fade-in');
                
                DOM.analysisDetails.style.opacity = 0;
                DOM.analysisDetails.style.transform = 'translateY(20px)';
                document.querySelectorAll('.chart-bar').forEach(bar => bar.classList.remove('highlight'));
                document.querySelectorAll('.chart-value-bar').forEach(bar => { bar.style.width = '0%'; bar.textContent = ''; });
            }, 400);
        }

        DOM.startBtn.addEventListener('click', startQuiz);
        DOM.restartBtn.addEventListener('click', restartQuiz);
        DOM.backBtn.addEventListener('click', goBack);
        DOM.viewResultsBtn.addEventListener('click', displayFinalResult);
    </script>
</body>
</html>
